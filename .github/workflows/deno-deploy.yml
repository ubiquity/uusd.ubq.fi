name: Deno Deploy

on:
  push:
  workflow_dispatch:

jobs:
  deploy:
    uses: ubiquity/deno-deploy-workflow/.github/workflows/deno-deploy-reusable.yml@main
    with:
      project: uusd-ubq-fi
      entrypoint: serve.ts
      bun_version: 1.2.x
      deno_version: 2.x
      install_command: bun install --backend=npm --registry=https://registry.npmjs.org
      build_command: bun run build
      build_env: |
        SUPABASE_URL=$SUPABASE_URL
        SUPABASE_ANON_KEY=$SUPABASE_ANON_KEY
        FRONTEND_URL=https://uusd.ubq.fi
      runtime_env: |
        STATIC_DIR=public
      include: |
        public/**
      debug_fetch_fail: true
      required_env: |
        DENO_DEPLOY_TOKEN
        SUPABASE_URL
        SUPABASE_ANON_KEY
    secrets:
      DENO_DEPLOY_TOKEN: ${{ secrets.DENO_DEPLOY_TOKEN }}
